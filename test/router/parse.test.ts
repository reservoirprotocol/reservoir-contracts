import * as Sdk from "@reservoir0x/sdk/src";
import { SignerWithAddress } from "@nomiclabs/hardhat-ethers/dist/src/signer-with-address";
import { expect } from "chai";
import { ethers } from "hardhat";

import {
  getChainId,
  reset,
} from "../utils";

describe("[ReservoirV6_0_1] Parser", () => {
  const chainId = getChainId();

  let deployer: SignerWithAddress;
  let alice: SignerWithAddress;
  let bob: SignerWithAddress;
  let carol: SignerWithAddress;
  let dan: SignerWithAddress;
  let emily: SignerWithAddress;

  beforeEach(async () => {
    [deployer, alice, bob, carol, dan, emily] = await ethers.getSigners();
  });

  afterEach(reset);

  it("Parse Executions from calldata", async () => {
    const router = new Sdk.RouterV6.Router(chainId, ethers.provider);
    const parsedExections = router.parseExecutions(`0x760f2a0b00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000ca04c45da318d5b7e7b14d5381ca59f09c73f00000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000013fbe85edc9000000000000000000000000000000000000000000000000000000000000000005e476af662900000000000000000000000000000000000000000000000000000000000000c00000000000000000000000001a60dfb071b039c6e33dcb3220891c83da72c1be000000000000000000000000c16157e00b1bff1522c6f01246b4fb621da048d00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000013fbe85edc9000000000000000000000000000000000000000000000000000000000000000005c000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000046000000000000000000000000000000000000000000000000000000000000004e00000000000000000000000004a13a55003eeaf84421ad16799bbbe68d851bbfe0000000000000000000000000000000006b429721d1f4c4cd256bf3a38c09ac600000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000657b8122000000000000000000000000000000000000000000000000000000006668cf5e000000000000000000000000000000000000000000000000000000000000000095437d0a1d4da48b0000000000000000249ebec16765a6eb7ff039db0362d0b60000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000097514cb55ed75e8bcfae82f6cfa3624ed39f73bf0000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011fc51222ce8000000000000000000000000000000000000000000000000000011fc51222ce80000000000000000000000000004a13a55003eeaf84421ad16799bbbe68d851bbfe000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001ff973cafa8000000000000000000000000000000000000000000000000000001ff973cafa800000000000000000000000000090bf90d7296ba9a28495325c80585508f1d07507000000000000000000000000000000000000000000000000000000000000004133ccd4ff2b4b466dea5899851dfb3e5f1e41bc0a665a8e752cc33e41867ffd936ad7281c3030bc9868a884727d229a1a2d9a68f4ee2dffe488c12d0d8741b96d1c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001d4da48b95437d0a`)
    expect(parsedExections.length).to.be.eq(1);
    expect(parsedExections[0].exectionParams.refundTo).to.be.eq('0xc16157e00b1bff1522c6f01246b4fb621da048d0')
  });
});
